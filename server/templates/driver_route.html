<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>司机轨迹可视化</title>
    <!-- 引入 echarts.js -->
    <script src="../static/js/echarts.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.0.min.js"></script>

</head>
<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div class="header">
        <h2>司机轨迹可视化</h2>
            司机ID <input type="text" class="driver_id" name="driver_id">
            日期   <input type="text" class="date" name="date" placeholder="例如:20170315">
            <input type="submit" class="submit" value="确定">
    </div>
    <div id="main" style="width: 600px;height:400px;"></div>
    <script type="text/javascript">
        var submit = $('.submit');
        var pick_route;
        var charge_route;
        submit.on('click', function() {
            var driver_id = $('.driver_id').val();
            var date = $('.date').val();

            $.post('/api/query', {
                driver_id: driver_id,
                date: date
            }, function(res) {
                var response = JSON.parse(res);
                pick_route = response.pick_route;
                charge_route = response.charge_route;
                $.post('/api/map', {
    	city: 'beijing'
    }, function(data) {
    	console.log(data);
    	echarts.registerMap('beijing', data);
    	// 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));
        // 指定图表的配置项和数据
        var option = {
            title: {
                text: ''
            },
            tooltip : {
                trigger: 'item'
            },
            legend: {
                orient: 'vertical',
                top: 'bottom',
                left: 'right',
                data:['接驾路径', '计费路径'],
                textStyle: {

                }
            },
//            backgroundColor: '#404a59',
            geo: {
                show: true,
                map: 'beijing',
//                roam: true,
                itemStyle: {
                    normal: {
                        areaColor: '#EAEAEA',
                        borderColor: '#404a59'
                    },
                    emphasis: {
                        areaColor: '#D9D9D9'
                    }
                }
            },
            series: [{
                name: '接驾路径',
                type: 'lines',
                coordinateSystem: 'geo',
                polyline: true,
                geoIndex: 0,
                zlevel: 1,
                data: [
                    {
                        coords: pick_route,
                        lineStyle: {
                            normal: {
                                color: '#FF0000',
                                width: 2,
                                curveness: 0.9

                            }
                        }
                    }
                ]
            },{
                name: '计费路径',
                type: 'lines',
                coordinateSystem: 'geo',
                polyline: true,
                geoIndex: 0,
                zlevel: 2,
                symbol: ['none', 'arrow'],
                symbolSize: 10,
                data: [
                    {
                        coords: charge_route,
                        lineStyle: {
                            normal: {
                                color: '#00FFFF',
                                width: 2,
                                curveness: 0.9
                            }
                        }
                    }
                ]
            }
            ]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);

            });

        });
    })

    </script>
</body>
</html>